<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Critique See 'N Say</title>
  <style>
    :root{
      --bg:#0b1020;
      --panel:#0f1733;

      --ring:#ffd35c;
      --ring2:#f3b528;

      --toyYellow:#ffd35c;
      --toyYellow2:#f0b72f;
      --toyBlue:#1a7bd6;
      --toyBlue2:#0f58a6;
      --toyRed:#e94b3c;

      --text:#eaf0ff;
      --muted:#9fb2d6;

      --shadow: 0 20px 60px rgba(0,0,0,.45);
      --shadow2: 0 12px 26px rgba(0,0,0,.35);
    }

    *{box-sizing:border-box}
    body{
      margin:0;
      font-family: system-ui, -apple-system, Segoe UI, Roboto, Helvetica, Arial, sans-serif;
      background: radial-gradient(1200px 900px at 20% 10%, #1b2a66 0%, var(--bg) 55%, #050713 100%);
      color:var(--text);
      min-height:100svh;
      display:grid;
      place-items:center;
      padding:24px;
    }

    .app{
      width:min(1020px, 100%);
      display:grid;
      grid-template-columns: 1.2fr .8fr;
      gap:24px;
      align-items:start;
    }
    @media (max-width: 860px){
      .app{grid-template-columns:1fr; gap:16px;}
    }

    .stage{
      position:relative;
      background: rgba(255,255,255,.04);
      border: 1px solid rgba(255,255,255,.08);
      border-radius: 24px;
      padding: 22px;
      box-shadow: var(--shadow);
      overflow:hidden;
    }

    /* Toy silhouette: handle + stand */
    .toyFrame{
      position:relative;
      width:min(560px, 100%);
      margin:0 auto;
      padding-top: 10px;
      padding-bottom: 24px;
    }
    .toyHandle{
      width: 64%;
      height: 80px;
      margin: 0 auto 10px;
      border-radius: 20px 20px 26px 26px;
      background: radial-gradient(120px 70px at 50% 30%, rgba(255,255,255,.55), rgba(255,255,255,0) 60%),
                  linear-gradient(180deg, var(--toyYellow) 0%, var(--toyYellow2) 100%);
      box-shadow: inset 0 -8px 0 rgba(0,0,0,.10), var(--shadow2);
      border: 1px solid rgba(0,0,0,.08);
      position:relative;
    }
    .toyHandle:before{
      content:"";
      position:absolute;
      left: 14%;
      right: 14%;
      top: 16px;
      bottom: 14px;
      border-radius: 16px;
      background: rgba(255,255,255,.85);
      box-shadow: inset 0 0 0 10px rgba(0,0,0,.06);
    }

    .toy{
      position:relative;
      width:100%;
      aspect-ratio: 1 / 1;
      display:grid;
      place-items:center;
    }

    .toyStand{
      position:absolute;
      left: 12%;
      right: 12%;
      bottom: -6px;
      height: 78px;
      border-radius: 26px;
      background: linear-gradient(180deg, var(--toyYellow) 0%, var(--toyYellow2) 100%);
      box-shadow: inset 0 -10px 0 rgba(0,0,0,.10), var(--shadow2);
      border: 1px solid rgba(0,0,0,.08);
      z-index:0;
    }

    /* Pointer (top indicator) */
    .pointer{
      position:absolute;
      top: 40px;
      left: 50%;
      transform: translateX(-50%);
      width: 0; height: 0;
      border-left: 14px solid transparent;
      border-right: 14px solid transparent;
      border-top: 22px solid rgba(255,255,255,.95);
      filter: drop-shadow(0 6px 8px rgba(0,0,0,.35));
      z-index:6;
    }

    /* Outer ring */
    .ring{
      position:absolute;
      inset: 7.5%;
      border-radius: 50%;
      background:
        radial-gradient(circle at 50% 35%, rgba(255,255,255,.55) 0%, rgba(255,255,255,0) 46%),
        linear-gradient(180deg, #ffe08b 0%, var(--ring) 55%, var(--ring2) 100%);
      box-shadow:
        inset 0 0 0 10px rgba(0,0,0,.08),
        inset 0 -14px 18px rgba(0,0,0,.12),
        0 14px 26px rgba(0,0,0,.25);
      z-index:1;
    }

    /* Spinning wheel (wedges) */
    .wheel{
      position:absolute;
      inset: 12%;
      border-radius: 50%;
      overflow:hidden;
      transform: rotate(0deg);
      will-change: transform;
      box-shadow: inset 0 0 0 10px rgba(0,0,0,.10);
      z-index:2;
      background: rgba(255,255,255,.05);
    }
    .wedge{
      position:absolute;
      inset:0;
      clip-path: polygon(50% 50%, 0% 0%, 100% 0%);
      transform-origin: 50% 50%;
      display:block;
    }
    .wedge::after{
      content:"";
      position:absolute;
      inset:0;
      background: linear-gradient(180deg, rgba(255,255,255,.18), rgba(0,0,0,.10));
      mix-blend-mode: overlay;
      pointer-events:none;
    }

    .wedge span{
      position:absolute;
      left:50%;
      top: 10%;
      transform: translateX(-50%) rotate(0deg);
      width: 78%;
      text-align:center;
      font-size: 14px;
      font-weight: 800;
      color: rgba(0,0,0,.75);
      text-shadow: 0 1px 0 rgba(255,255,255,.35);
      user-select:none;
      pointer-events:none;
      line-height: 1.05;
    }
    .wedge .thumb{
      position:absolute;
      left:50%;
      top: 29%;
      transform: translateX(-50%);
      width: 64px;
      height: 64px;
      border-radius: 50%;
      background-size: cover;
      background-position: center;
      border: 6px solid rgba(255,255,255,.85);
      box-shadow: 0 10px 16px rgba(0,0,0,.25);
      display:none;
    }
    .wedge.hasImage .thumb{ display:block; }
    .wedge.hasImage span{ top: 10%; }

    @media (max-width: 520px){
      .wedge span{font-size:12px;}
      .wedge .thumb{ width:54px; height:54px; border-width:5px; }
    }

    /* Center disc */
    .center{
      position:absolute;
      inset: 35%;
      border-radius: 50%;
      background: radial-gradient(circle at 40% 35%, #ff7a6e 0%, var(--toyRed) 55%, #c73327 100%);
      box-shadow: inset 0 0 0 12px rgba(0,0,0,.10),
                  0 16px 28px rgba(0,0,0,.35);
      display:grid;
      place-items:center;
      z-index:5;
      user-select:none;
      touch-action: manipulation;
      cursor: default;
    }
    .center .badge{
      width: 76%;
      aspect-ratio: 1 / 1;
      border-radius: 50%;
      background:
        radial-gradient(circle at 40% 35%, #2fa0ff 0%, var(--toyBlue) 60%, var(--toyBlue2) 100%);
      box-shadow: inset 0 0 0 10px rgba(0,0,0,.12);
      display:grid;
      place-items:center;
      padding:12px;
      text-align:center;
      border: 1px solid rgba(255,255,255,.20);
    }
    .center .badge strong{
      display:block;
      font-size: 13px;
      letter-spacing:.7px;
      text-transform: uppercase;
    }
    .center .badge small{
      display:block;
      margin-top:6px;
      color: rgba(255,255,255,.86);
      font-weight: 700;
    }

    /* Pull string */
    .stringWrap{
      position:absolute;
      right: -10px;
      bottom: 18%;
      display:flex;
      align-items:center;
      gap:10px;
      z-index:7;
    }
    .string{
      width: 165px;
      height: 8px;
      border-radius: 999px;
      background: linear-gradient(90deg, rgba(255,255,255,.18), rgba(255,255,255,.78), rgba(255,255,255,.18));
      box-shadow: 0 10px 18px rgba(0,0,0,.25);
      transform-origin: left center;
    }
    .handle{
      width: 46px; height: 38px;
      border-radius: 12px;
      background: #ff5b5b;
      box-shadow: 0 12px 20px rgba(0,0,0,.25), inset 0 -5px 0 rgba(0,0,0,.12);
      border: 1px solid rgba(255,255,255,.25);
      cursor:pointer;
      display:grid;
      place-items:center;
      user-select:none;
      touch-action: manipulation;
    }
    .handle:active{ transform: translateY(1px); }
    .handle svg{opacity:.92}

    /* Right panel */
    .panel{
      background: rgba(255,255,255,.04);
      border: 1px solid rgba(255,255,255,.08);
      border-radius: 24px;
      padding: 18px;
      box-shadow: var(--shadow);
    }
    .panel h1{
      font-size: 18px;
      margin: 0 0 10px;
      letter-spacing:.2px;
    }
    .panel p{
      margin: 0 0 12px;
      color: var(--muted);
      line-height: 1.35;
      font-size: 14px;
    }

    .row{
      display:flex;
      gap:10px;
      flex-wrap:wrap;
      align-items:center;
      margin-top: 10px;
    }

    button{
      appearance:none;
      border: 1px solid rgba(255,255,255,.14);
      background: rgba(255,255,255,.06);
      color: var(--text);
      padding: 10px 12px;
      border-radius: 12px;
      cursor:pointer;
      font-weight: 750;
      letter-spacing:.2px;
    }
    button:hover{ background: rgba(255,255,255,.10); }
    button:disabled{ opacity:.55; cursor:not-allowed; }

    .pill{
      display:flex;
      align-items:center;
      gap:8px;
      padding: 10px 12px;
      border-radius: 12px;
      border: 1px solid rgba(255,255,255,.14);
      background: rgba(0,0,0,.18);
      color: rgba(255,255,255,.88);
      font-size: 13px;
      font-weight: 700;
      user-select:none;
    }
    .pill input{ transform: scale(1.1); }

    textarea{
      width:100%;
      min-height: 200px;
      resize: vertical;
      border-radius: 14px;
      border: 1px solid rgba(255,255,255,.12);
      background: rgba(0,0,0,.20);
      color: var(--text);
      padding: 12px;
      font-size: 13px;
      line-height:1.35;
      outline:none;
    }
    .hint{
      margin-top:10px;
      font-size:12px;
      color: rgba(255,255,255,.65);
      line-height: 1.35;
    }

    .locked textarea{ display:none; }
    .locked #apply{ display:none; }
    .locked #editorLabel{ display:none; }
    .locked #formatHint{ display:none; }

    /* Overlay */
    .overlay{
      position:fixed;
      inset:0;
      display:grid;
      place-items:center;
      background: rgba(0,0,0,.55);
      opacity:0;
      pointer-events:none;
      transition: opacity .18s ease;
      padding: 24px;
      z-index:50;
    }
    .overlay.show{
      opacity:1;
      pointer-events:auto;
    }
    .overlayCard{
      width:min(860px, 100%);
      background: rgba(15, 23, 51, .92);
      border: 1px solid rgba(255,255,255,.12);
      border-radius: 22px;
      padding: 18px 18px 16px;
      box-shadow: var(--shadow);
      display:grid;
      grid-template-columns: 1fr;
      gap: 12px;
    }
    .overlayCard .q{
      font-size: clamp(22px, 4vw, 38px);
      font-weight: 900;
      line-height:1.12;
      margin: 0;
    }
    .overlayCard .sub{
      margin:0;
      color: rgba(255,255,255,.70);
      font-size: 13px;
    }
    .overlayImg{
      width: min(520px, 100%);
      aspect-ratio: 4 / 3;
      border-radius: 18px;
      background: rgba(255,255,255,.06);
      border: 1px solid rgba(255,255,255,.10);
      background-size: cover;
      background-position: center;
      display:none;
    }
    .overlayImg.show{ display:block; }
  </style>
</head>

<body>
  <div class="app">
    <div class="stage">
      <div class="toyFrame">
        <div class="toyHandle" aria-hidden="true"></div>

        <div class="toy" aria-label="See 'N Say critique wheel">
          <div class="toyStand" aria-hidden="true"></div>
          <div class="pointer" aria-hidden="true"></div>
          <div class="ring" aria-hidden="true"></div>

          <div id="wheel" class="wheel" role="img" aria-label="Spinning question wheel"></div>

          <div id="center" class="center" aria-label="Center badge (long-press to unlock when locked)">
            <div class="badge">
              <div>
                <strong>Critique</strong>
                <small>Pull to ask</small>
              </div>
            </div>
          </div>

          <div class="stringWrap">
            <div id="string" class="string" aria-hidden="true"></div>
            <div id="handle" class="handle" title="Pull" role="button" aria-label="Pull the string">
              <svg width="22" height="22" viewBox="0 0 24 24" fill="none" aria-hidden="true">
                <path d="M12 5v14m0 0l-5-5m5 5l5-5" stroke="white" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
              </svg>
            </div>
          </div>
        </div>
      </div>
    </div>

    <aside id="panel" class="panel">
      <h1>Critique See ’N Say</h1>
      <p>Tap the pull handle to spin. The wheel lands on a question, shows it big, and speaks it out loud.</p>

      <div class="row">
        <button id="spin">Spin</button>
        <button id="testVoice">Enable / Test voice</button>
        <button id="lockBtn">Lock editor</button>
      </div>

      <div class="row" style="margin-top:12px;">
        <label class="pill">
          <input id="noRepeats" type="checkbox" />
          No repeats until all used
        </label>

        <label class="pill">
          <input id="showThumbs" type="checkbox" checked />
          Show image thumbnails
        </label>
      </div>

      <div id="editorLabel" style="font-weight:800; font-size:13px; margin-top:14px;">
        Questions (one per line)
      </div>
      <textarea id="questions"></textarea>

      <div id="formatHint" class="hint">
        Optional image format: <b>Question | imageURL</b><br/>
        Example: <i>Why is it so heavy? | https://example.com/heavy.jpg</i>
      </div>

      <div class="row">
        <button id="apply">Apply questions</button>
      </div>

      <div class="hint">
        Mobile note: browsers often require a tap before voice works. Use “Enable / Test voice” once.<br/>
        Locked note: long-press the <b>center badge</b> ~0.8s to unlock.
      </div>
    </aside>
  </div>

  <div id="overlay" class="overlay" role="dialog" aria-modal="true" aria-label="Selected question">
    <div class="overlayCard">
      <div id="overlayImg" class="overlayImg" aria-hidden="true"></div>
      <p class="q" id="overlayText">…</p>
      <p class="sub">Tap anywhere to dismiss.</p>
    </div>
  </div>

  <script>
    // ===== Data model =====
    // Each entry: { text: string, img?: string }
    const DEFAULT_ITEMS = [
      { text: "Why is it so small?" },
      { text: "Why is it so heavy?" },
      { text: "Why is it so light?" },
      { text: "Why does it sit like that?" },
      { text: "What decision feels most intentional here?" },
      { text: "What feels unresolved?" },
      { text: "Where does the surface help (or fight) the form?" },
      { text: "What would you change if you made it again?" },
      { text: "What’s the strongest part of this piece?" },
      { text: "What’s the quietest part of this piece?" },
      { text: "What’s the piece asking the viewer to notice?" },
      { text: "What’s one risk you could push further?" }
    ];

    const WEDGE_COLORS = [
      "#ffd35c", "#bfe6ff", "#c7f2c4", "#ffd0e0",
      "#ffe6a6", "#cdd7ff", "#d2f7ff", "#ffd9b5"
    ];

    // ===== Elements =====
    const wheelEl = document.getElementById("wheel");
    const handleEl = document.getElementById("handle");
    const stringEl = document.getElementById("string");
    const centerEl = document.getElementById("center");

    const overlayEl = document.getElementById("overlay");
    const overlayTextEl = document.getElementById("overlayText");
    const overlayImgEl = document.getElementById("overlayImg");

    const panelEl = document.getElementById("panel");
    const questionsTA = document.getElementById("questions");

    const applyBtn = document.getElementById("apply");
    const spinBtn = document.getElementById("spin");
    const testVoiceBtn = document.getElementById("testVoice");
    const lockBtn = document.getElementById("lockBtn");

    const noRepeatsChk = document.getElementById("noRepeats");
    const showThumbsChk = document.getElementById("showThumbs");

    // ===== State =====
    let items = [...DEFAULT_ITEMS];
    let isSpinning = false;
    let currentRotation = 0; // degrees

    // deterministic bag (no repeats until empty)
    let bag = [];

    // Persisted preferences
    const LS = {
      locked: "sns_locked",
      noRepeats: "sns_norepeats",
      showThumbs: "sns_showthumbs",
      items: "sns_items_v1"
    };

    // ===== Speech =====
    function speak(text){
      try{
        window.speechSynthesis.cancel();
        const utter = new SpeechSynthesisUtterance(text);
        utter.rate = 1.0;
        utter.pitch = 1.0;
        utter.volume = 1.0;
        const voices = window.speechSynthesis.getVoices?.() || [];
        const en = voices.find(v => /en/i.test(v.lang));
        if(en) utter.voice = en;
        window.speechSynthesis.speak(utter);
      }catch(e){
        // ignore
      }
    }

    function showOverlay(text, imgUrl){
      overlayTextEl.textContent = text;
      if(imgUrl && showThumbsChk.checked){
        overlayImgEl.style.backgroundImage = `url("${imgUrl}")`;
        overlayImgEl.classList.add("show");
      }else{
        overlayImgEl.classList.remove("show");
        overlayImgEl.style.backgroundImage = "";
      }
      overlayEl.classList.add("show");
    }
    overlayEl.addEventListener("click", () => overlayEl.classList.remove("show"));

    // ===== Parsing / serialization =====
    function serializeItems(list){
      // One per line: text | img
      return list.map(it => it.img ? `${it.text} | ${it.img}` : it.text).join("\n");
    }

    function parseItems(raw){
      return raw
        .split("\n")
        .map(s => s.trim())
        .filter(Boolean)
        .map(line => {
          const parts = line.split("|").map(p => p.trim()).filter(Boolean);
          if(parts.length >= 2){
            return { text: parts[0], img: parts.slice(1).join(" | ") };
          }
          return { text: line };
        });
    }

    // ===== Wheel build =====
    function buildWheel(){
      wheelEl.innerHTML = "";
      const n = Math.max(2, items.length);
      const slice = 360 / n;

      for(let i=0;i<n;i++){
        const wedge = document.createElement("div");
        wedge.className = "wedge";
        wedge.style.transform = `rotate(${i*slice}deg)`;
        wedge.style.background = WEDGE_COLORS[i % WEDGE_COLORS.length];

        const label = document.createElement("span");
        label.textContent = items[i]?.text ?? `Question ${i+1}`;
        label.style.transform = `translateX(-50%) rotate(${-i*slice}deg)`;

        wedge.appendChild(label);

        const img = items[i]?.img;
        const thumbsOn = showThumbsChk.checked;
        if(img && thumbsOn){
          wedge.classList.add("hasImage");
          const thumb = document.createElement("div");
          thumb.className = "thumb";
          thumb.style.backgroundImage = `url("${img}")`;
          // Rotate thumb back (so it doesn't spin relative to screen)
          thumb.style.transform = `translateX(-50%) rotate(${-i*slice}deg)`;
          wedge.appendChild(thumb);
        }

        wheelEl.appendChild(wedge);
      }
    }

    // ===== Deterministic selection =====
    function shuffle(arr){
      for(let i=arr.length-1;i>0;i--){
        const j = Math.floor(Math.random()*(i+1));
        [arr[i], arr[j]] = [arr[j], arr[i]];
      }
      return arr;
    }

    function refillBag(){
      bag = shuffle([...Array(items.length).keys()]);
    }

    function pickIndex(){
      if(!noRepeatsChk.checked){
        return Math.floor(Math.random() * items.length);
      }
      if(bag.length === 0){
        refillBag();
      }
      return bag.pop();
    }

    // ===== Spin mechanics =====
    function randInt(min, max){
      return Math.floor(Math.random() * (max - min + 1)) + min;
    }

    function animatePull(){
      stringEl.animate(
        [{ transform: "scaleX(1)" }, { transform: "scaleX(1.28)" }, { transform: "scaleX(1)" }],
        { duration: 230, easing: "ease-out" }
      );
    }

    function spin(){
      if(isSpinning) return;
      if(items.length < 2) return;

      isSpinning = true;
      spinBtn.disabled = true;
      applyBtn.disabled = true;

      animatePull();

      const n = items.length;
      const slice = 360 / n;

      const targetIndex = pickIndex();

      // Full spins
      const extraSpins = randInt(4, 7) * 360;

      const targetCenter = targetIndex * slice + slice / 2;
      const jitter = (Math.random() * (slice * 0.18)) - (slice * 0.09);
      const targetRotation = extraSpins + (360 - (targetCenter % 360)) + jitter;

      const endRotation = currentRotation + targetRotation;

      wheelEl.style.transitio
